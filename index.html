<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="My personal blog - Thoughts, stories and ideas">
    <meta name="keywords" content="blog, articles, programming, technology">
    <meta name="author" content="My Blog">
    <meta property="og:title" content="My Blog">
    <meta property="og:description" content="Thoughts, stories and ideas">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="My Blog">
    <meta name="twitter:description" content="Thoughts, stories and ideas">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="./data/manifest.json">

    <title>Otmane Echaibi Blog</title>
    <link rel="icon" type="image/png" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüìù%3C/text%3E%3C/svg%3E">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
    </script>
    <link rel="stylesheet" href="./styles/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="./images/profile.jpg" alt="Profile Picture" class="profile-pic" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Crect fill=%22%23ddd%22 width=%22120%22 height=%22120%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2240%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3Eüë§%3C/text%3E%3C/svg%3E'">
            <h1>otmane Echaibi Blog</h1>
            <h2>Thoughts, stories, and ideas from a curious mind.</h2>
        </div>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search posts...">
            <span class="search-icon">üîç</span>
        </div>

        <div class="content">
            <div class="posts-grid" id="postsContainer"></div>
            <div class="pagination" id="pagination"></div>
        </div>

        <footer>
            <p>&copy; 2025 <a href="https://www.linkedin.com/in/otmane-echaibi-90a524309/" target="_blank" rel="noopener noreferrer">Otmane Echaibi</a>
            | All Rights Reserved.</p>
        </footer>
    </div>

    <button class="back-to-top" id="backToTop" onclick="scrollToTop()" title="Back to top">‚Üë</button>

    <script>
        let allPosts = [];
        let filteredPosts = [];
        let currentPage = 1;
        const postsPerPage = 10;

        async function loadPosts() {
            try {
                const response = await fetch('./data/posts.json');
                allPosts = await response.json();
                allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
                filteredPosts = [...allPosts];
                renderPosts();
            } catch (err) {
                document.getElementById('postsContainer').innerHTML = 
                    '<div class="no-results">No posts found. Add some markdown files!</div>';
            }
        }

        function renderPosts() {
            const container = document.getElementById('postsContainer');
            const start = (currentPage - 1) * postsPerPage;
            const end = start + postsPerPage;
            const postsToShow = filteredPosts.slice(start, end);

            if (postsToShow.length === 0) {
                container.innerHTML = '<div class="no-results">No posts found matching your search.</div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            container.innerHTML = postsToShow.map(post => `
                <div class="post-card">
                    <h2><a href="${post.file}">${post.title}</a></h2>
                    <div class="post-date">${post.date}</div>
                </div>
            `).join('');

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            if (totalPages <= 1) {
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            if (currentPage > 1) {
                paginationHTML += `<button onclick="changePage(${currentPage - 1})">‚Üê Prev</button>`;
            }

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `<button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += '<button disabled>...</button>';
                }
            }

            if (currentPage < totalPages) {
                paginationHTML += `<button onclick="changePage(${currentPage + 1})">Next ‚Üí</button>`;
            }

            document.getElementById('pagination').innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            renderPosts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filteredPosts = allPosts.filter(post => 
                post.title.toLowerCase().includes(query) ||
                post.date.includes(query)
            );
            currentPage = 1;
            renderPosts();
        });

        // Back to top button functionality
        const backToTopButton = document.getElementById('backToTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });
        
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        loadPosts();
    </script>
</body>
</html>